<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The BioCro C++ Library: /github/workspace/src/module_library/AuxBioCro.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The BioCro C++ Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_aux_bio_cro_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AuxBioCro.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_aux_bio_cro_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  /src/AuxBioCro.c by Fernando Ezequiel Miguez  Copyright (C) 2007 - 2015</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Part of the code here (sunML, EvapoTrans, SoilEvapo, TempTo and</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  the *prof functions) are based on code in WIMOVAC. WIMOVAC is</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  copyright of Stephen Long and Stephen Humphries.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  Documentation for WIMOVAC can be found at</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *  http://www.life.illinois.edu/plantbio/wimovac/ (checked 02-13-2010)</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/* This file will contain functions which are common to several */</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/* routines in the BioCro package. These are functions needed */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/* internally. The normal user will not need them */</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="c4photo_8h.html">c4photo.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_bio_cro_8h.html">BioCro.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;../constants.h&quot;</span>  <span class="comment">// for pi, e, atmospheric_pressure_at_sea_level,</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                           <span class="comment">// ideal_gas_constant, molar_mass_of_water,</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                           <span class="comment">// stefan_boltzmann, celsius_to_kelvin</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">   25</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">double</span> lambda)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">// The probability density for the Poisson distribution is</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// e^-lambda * lambda^x / x!</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// The factorial term produces numbers too large to hold, so perform the calculation in the log domain.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// n! can be estimated by the approximation sqrt(2 * pi * x) * (x / e)^x.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keyword">using</span> math_constants::pi;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keyword">using</span> math_constants::e;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">// Stirling&#39;s approximation for n!:</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordtype">double</span> factorial_x = sqrt(2 * pi * x) * pow((x / e), x);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordtype">double</span> log_result = -lambda + x * log(lambda) - log(factorial_x);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">return</span> exp(log_result);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;}</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#aeb1ea5a7e843d3a15a3aaeb66f38f9cd">   62</a></span>&#160;<a class="code" href="struct_light__model.html">Light_model</a> <a class="code" href="_aux_bio_cro_8cpp.html#aeb1ea5a7e843d3a15a3aaeb66f38f9cd">lightME</a>(<span class="keywordtype">double</span> cosine_zenith_angle, <span class="keywordtype">double</span> atmospheric_pressure)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">double</span> direct_irradiance_transmittance;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">double</span> diffuse_irradiance_transmittance;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">if</span> (cosine_zenith_angle &lt;= 0) { <span class="comment">// Check if the Sun is at or below the horizon. If it is, directly set direct_irradiance_transmittance and diffuse_irradiance_transmittance because the equations below would otherwise produce erroneous results. The Sun is at or below the horizon when cosine_zenith_angle is less than or equal to 0.</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        direct_irradiance_transmittance = 0;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        diffuse_irradiance_transmittance = 1;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// If the Sun is above the horizon, calculate diffuse and direct irradiance from the Sun&#39;s angle to the ground and the path through the atmosphere.</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        constexpr <span class="keywordtype">double</span> atmospheric_transmittance = 0.85; <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> pressure_ratio = atmospheric_pressure / physical_constants::atmospheric_pressure_at_sea_level; <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        constexpr <span class="keywordtype">double</span> proportion_of_irradiance_scattered = 0.3; <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        direct_irradiance_transmittance = pow(atmospheric_transmittance, (pressure_ratio / cosine_zenith_angle)); <span class="comment">// Modified from equation 11.11 of Norman and Campbell.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        diffuse_irradiance_transmittance = proportion_of_irradiance_scattered * (1 - direct_irradiance_transmittance) * cosine_zenith_angle; <span class="comment">// Modified from equation 11.13 of Norman and Campbell.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="struct_light__model.html">Light_model</a> light_model;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    light_model.<a class="code" href="struct_light__model.html#adbd9b09d7568e85d0f64380f3dcdcb47">direct_irradiance_fraction</a> = direct_irradiance_transmittance / (direct_irradiance_transmittance + diffuse_irradiance_transmittance); <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    light_model.<a class="code" href="struct_light__model.html#a5a75f578f4b205eab5fdd6d95ac2961e">diffuse_irradiance_fraction</a> = diffuse_irradiance_transmittance / (direct_irradiance_transmittance + diffuse_irradiance_transmittance); <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">return</span> light_model;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ac923d835bbf1f5120b1cafcbf3da046d">  120</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ac923d835bbf1f5120b1cafcbf3da046d">absorbed_shortwave_from_incident_ppfd</a>(</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">double</span> incident_ppfd,        <span class="comment">// micromol / m^2 / s</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">double</span> par_energy_content,   <span class="comment">// J / micromol</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">double</span> par_energy_fraction,  <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">double</span> leaf_reflectance,     <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">double</span> leaf_transmittance    <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">double</span> incident_par = incident_ppfd * par_energy_content;  <span class="comment">// J / m^2 / s</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">double</span> incident_nir = incident_par *</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                          (1 - par_energy_fraction) /</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                          par_energy_fraction;  <span class="comment">// J / m^2 /s</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">double</span> incident_shortwave = incident_par + incident_nir;  <span class="comment">// J / m^2 / s</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">return</span> incident_shortwave *</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;           (1 - leaf_reflectance - leaf_transmittance) /</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;           (1 - leaf_transmittance);  <span class="comment">// J / m^2 / s</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#aa642fb79dd7e9bc444cb8eae150fd64c">  185</a></span>&#160;<a class="code" href="struct_light__profile.html">Light_profile</a> <a class="code" href="_aux_bio_cro_8cpp.html#aa642fb79dd7e9bc444cb8eae150fd64c">sunML</a>(</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordtype">double</span> ambient_ppfd_beam,     <span class="comment">// micromol / (m^2 beam) / s</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">double</span> ambient_ppfd_diffuse,  <span class="comment">// micromol / m^2 / s</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">double</span> lai,                   <span class="comment">// dimensionless from m^2 / m^2</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">int</span> nlayers,                  <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">double</span> cosine_zenith_angle,   <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">double</span> kd,                    <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">double</span> chil,                  <span class="comment">// dimensionless from m^2 / m^2</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">double</span> absorptivity,          <span class="comment">// dimensionless from mol / mol</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">double</span> heightf,               <span class="comment">// m^-1 from m^2 leaf / m^2 ground / m height</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">double</span> par_energy_content,    <span class="comment">// J / micromol</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">double</span> par_energy_fraction,   <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordtype">double</span> leaf_transmittance,    <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">double</span> leaf_reflectance       <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (nlayers &lt; 1 || nlayers &gt; <a class="code" href="_aux_bio_cro_8h.html#a57179778cb6aed95fb9f484b55873d6f">MAXLAY</a>) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;nlayers must be at least 1 but no more than MAXLAY.&quot;</span>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span> (cosine_zenith_angle &gt; 1 || cosine_zenith_angle &lt; -1) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;cosine_zenith_angle must be between -1 and 1.&quot;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (kd &gt; 1 || kd &lt; 0) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;kd must be between 0 and 1.&quot;</span>);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (chil &lt; 0) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;chil must be non-negative.&quot;</span>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> (absorptivity &gt; 1 || absorptivity &lt; 0) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;absorptivity must be between 0 and 1.&quot;</span>);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">if</span> (heightf &lt;= 0) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;heightf must greater than zero.&quot;</span>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// Calculate the leaf shape factor for an ellipsoidal leaf angle</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">// distribution using the equation from page 251 of Campbell &amp; Norman</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// (1998). We will use this value as `k`, the canopy extinction coefficient</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// for photosynthetically active radiation throughout the canopy. This</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// quantity represents the ratio of horizontal area to total area for leaves</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// in the canopy and is therefore dimensionless from</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// (m^2 ground) / (m^2 leaf).</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordtype">double</span> zenith_angle = acos(cosine_zenith_angle);  <span class="comment">// radians</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordtype">double</span> k0 = sqrt(pow(chil, 2) + pow(tan(zenith_angle), 2));</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordtype">double</span> k1 = chil + 1.744 * pow((chil + 1.182), -0.733);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordtype">double</span> k = k0 / k1;  <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordtype">double</span> lai_per_layer = lai / nlayers;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// Calculate the ambient direct PPFD through a surface parallel to the ground</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> ambient_ppfd_beam_ground = ambient_ppfd_beam * cosine_zenith_angle;  <span class="comment">// micromol / (m^2 ground) / s</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// Calculate the ambient direct PPFD through a unit area of leaf surface</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">double</span> ambient_ppfd_beam_leaf = ambient_ppfd_beam_ground * k;  <span class="comment">// micromol / (m^2 leaf) / s</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="struct_light__profile.html">Light_profile</a> light_profile;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment">// Get the cumulative LAI for this layer, which represents the total</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="comment">// leaf area above this layer</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> cumulative_lai = lai_per_layer * (i + 0.5);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="comment">// Calculate the amount of PPFD scattered out of the direct beam using</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">// Equations 15.6 and 15.1 from Campbell &amp; Norman (1998), following</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="comment">// example 15.2. This is a diffuse flux density representing the flux</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment">// through any surface.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> scattered_ppfd =</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            ambient_ppfd_beam_ground * (exp(-k * sqrt(absorptivity) * cumulative_lai) -</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                        exp(-k * cumulative_lai));  <span class="comment">// micromol / m^2 / s</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="comment">// Calculate the total flux of diffuse photosynthetically active light</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">// in this layer by combining the scattered PPFD with the ambient</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">// diffuse PPFD. Here we use Equation 15.6 with `alpha` = 1 and</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="comment">// `kbe(phi)` = kd.</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordtype">double</span> diffuse_ppfd =</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            ambient_ppfd_diffuse * exp(-kd * cumulative_lai) + scattered_ppfd;  <span class="comment">// micromol / m^2 / s</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="comment">// Calculate the fraction of sunlit and shaded leaves in this canopy</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="comment">// layer using Equation 15.21.</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> Ls = (1 - exp(-k * lai_per_layer)) * exp(-k * cumulative_lai) / k;  <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordtype">double</span> sunlit_fraction = Ls / lai_per_layer;                                     <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordtype">double</span> shaded_fraction = 1 - sunlit_fraction;                                    <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="comment">// Calculate an &quot;average&quot; incident PPFD for the sunlit and shaded leaves</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="comment">// that doesn&#39;t seem to be based on a formula from Campbell &amp; Norman</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="comment">// (1998). It&#39;s interpreted as a flux density through a unit of leaf</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">// area, but that may not be correct.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordtype">double</span> average_ppfd =</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            (sunlit_fraction * (ambient_ppfd_beam_leaf + diffuse_ppfd) + shaded_fraction * diffuse_ppfd) *</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            (1 - exp(-k * lai_per_layer)) / k;  <span class="comment">// micromol / (m^2 leaf) / s</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="comment">// For values of cosine_zenith_angle close to or less than 0, in place</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="comment">// of the calculations above, we want to use the limits of the above</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="comment">// expressions as cosine_zenith_angle approaches 0 from the right:</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">if</span> (cosine_zenith_angle &lt;= 1E-10) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            ambient_ppfd_beam_leaf = ambient_ppfd_beam / k1;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            diffuse_ppfd = ambient_ppfd_diffuse * exp(-kd * cumulative_lai);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            sunlit_fraction = 0;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            shaded_fraction = 1;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            average_ppfd = 0;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">// Store these values of incident PPFD</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a9be4ce772b6a8d75462522bab9c0512a">sunlit_incident_ppfd</a>[i] = ambient_ppfd_beam_leaf + diffuse_ppfd;  <span class="comment">// micromole / (m^2 leaf) / s</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a9bb181e980d9d35d2856a8710f793539">incident_ppfd_scattered</a>[i] = scattered_ppfd;                      <span class="comment">// micromole / m^2 / s</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a73dba19296f83ec076a71483ae244d51">shaded_incident_ppfd</a>[i] = diffuse_ppfd;                           <span class="comment">// micromole / (m^2 leaf) / s</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#ac3f290bdde8c99228d5842027c2fb1fe">average_incident_ppfd</a>[i] = average_ppfd;                          <span class="comment">// micromole / (m^2 leaf) / s</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a61f0087975de6eb7f7434b4cfc0e51ae">sunlit_fraction</a>[i] = sunlit_fraction;                             <span class="comment">// dimensionless from m^2 / m^2</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a0e8db02a88bb67528a3719bccff28ab3">shaded_fraction</a>[i] = shaded_fraction;                             <span class="comment">// dimensionless from m^2 / m^2</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a9271d425f0a7fe98406dc25f2e148bb4">height</a>[i] = (lai - cumulative_lai) / heightf;                     <span class="comment">// m</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="comment">// We also need to determine the total amount of absorbed solar energy</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="comment">// for sunlit and shaded leaves</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#acf30e3338a8853fb5496c2c232459e8b">sunlit_absorbed_shortwave</a>[i] =</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <a class="code" href="_aux_bio_cro_8cpp.html#ac923d835bbf1f5120b1cafcbf3da046d">absorbed_shortwave_from_incident_ppfd</a>(</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                ambient_ppfd_beam_leaf + diffuse_ppfd,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                par_energy_content,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                par_energy_fraction,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                leaf_reflectance,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                leaf_transmittance);  <span class="comment">// J / (m^2 leaf) / s</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#aba2bdb68bcb2ed561da09a980ff0373b">shaded_absorbed_shortwave</a>[i] =</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <a class="code" href="_aux_bio_cro_8cpp.html#ac923d835bbf1f5120b1cafcbf3da046d">absorbed_shortwave_from_incident_ppfd</a>(</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                diffuse_ppfd,</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                par_energy_content,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                par_energy_fraction,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                leaf_reflectance,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                leaf_transmittance);  <span class="comment">// J / (m^2 leaf) / s</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a5f4b00c823c545e40c91a4b2ebc5a619">average_absorbed_shortwave</a>[i] =</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <a class="code" href="_aux_bio_cro_8cpp.html#ac923d835bbf1f5120b1cafcbf3da046d">absorbed_shortwave_from_incident_ppfd</a>(</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                average_ppfd,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                par_energy_content,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                par_energy_fraction,</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                leaf_reflectance,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                leaf_transmittance);  <span class="comment">// J / (m^2 leaf) / s</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">return</span> light_profile;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;}</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">/* Additional Functions needed for EvapoTrans */</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ad5f0fc680176f312e47c32701ce779f7">  337</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_aux_bio_cro_8cpp.html#ad5f0fc680176f312e47c32701ce779f7">WINDprof</a>(<span class="keywordtype">double</span> WindSpeed, <span class="keywordtype">double</span> LAI, <span class="keywordtype">int</span> nlayers,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;              <span class="keywordtype">double</span>* wind_speed_profile)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;{</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    constexpr <span class="keywordtype">double</span> k = 0.7;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordtype">double</span> LI = LAI / nlayers;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordtype">double</span> CumLAI = LI * (i + 1);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        wind_speed_profile[i] = WindSpeed * exp(-k * (CumLAI - LI));</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#aa4d2cdd07093428af4830f4c8afd660c">  438</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_aux_bio_cro_8cpp.html#aa4d2cdd07093428af4830f4c8afd660c">RHprof</a>(<span class="keywordtype">double</span> RH, <span class="keywordtype">int</span> nlayers, <span class="keywordtype">double</span>* relative_humidity_profile)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;{</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">if</span> (RH &gt; 1 || RH &lt; 0) {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;RH must be between 0 and 1.&quot;</span>);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span> (nlayers &lt; 1 || nlayers &gt; <a class="code" href="_aux_bio_cro_8h.html#a57179778cb6aed95fb9f484b55873d6f">MAXLAY</a>) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;nlayers must be at least 1 but no more than MAXLAY.&quot;</span>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> kh = 1 - RH;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordtype">double</span> j = i + 1;  <span class="comment">// Explicitly make j a double so that j / nlayers isn&#39;t truncated.</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordtype">double</span> temp_rh = RH * exp(kh * (j / nlayers));</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        relative_humidity_profile[i] = temp_rh;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;}</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a2905c23b422ad454d9577841ca594d0d">  457</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_aux_bio_cro_8cpp.html#a2905c23b422ad454d9577841ca594d0d">LNprof</a>(<span class="keywordtype">double</span> LeafN, <span class="keywordtype">double</span> LAI, <span class="keywordtype">int</span> nlayers, <span class="keywordtype">double</span> kpLN, <span class="keywordtype">double</span>* leafN_profile)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;{</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordtype">double</span> LI = LAI / nlayers;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i)</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordtype">double</span> CumLAI = LI * (i + 1);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        leafN_profile[i] = LeafN * exp(-kpLN * (CumLAI - LI));</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">  492</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a>(</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordtype">double</span> air_temperature  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;{</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">return</span> 1.295163636 + -0.004258182 * air_temperature;  <span class="comment">// kg / m^3</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;}</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a6979290fdcfafddf3aaa343a367c1f81">  511</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a6979290fdcfafddf3aaa343a367c1f81">dry_air_density</a>(</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> air_temperature,  <span class="comment">// kelvin</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> air_pressure      <span class="comment">// Pa</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;{</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    constexpr <span class="keywordtype">double</span> r_specific = physical_constants::ideal_gas_constant /</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        physical_constants::molar_mass_of_dry_air; <span class="comment">// J / kg / K</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">return</span> air_pressure / r_specific / air_temperature;  <span class="comment">// kg / m^3</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;}</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a460579178484521ecc50b488c58bb0dd">  548</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a460579178484521ecc50b488c58bb0dd">TempToLHV</a>(</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordtype">double</span> temperature  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;{</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">return</span> 2501000 + -2372.727 * temperature;  <span class="comment">// J / kg.</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;}</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ae316a7cc0aa11d92732e36c4665361ce">  568</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ae316a7cc0aa11d92732e36c4665361ce">water_latent_heat_of_vaporization_henderson</a>(</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordtype">double</span> temperature)  <span class="comment">// kelvin</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;{</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">return</span> 1.91846e6 * pow(temperature / (temperature - 33.91), 2);  <span class="comment">// J / kg</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;}</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">  601</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a>(</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordtype">double</span> air_temperature  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;{</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">return</span> (0.338376068 + 0.011435897 * air_temperature + 0.001111111 *</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            pow(air_temperature, 2)) * 1e-3;  <span class="comment">//  kg / m^3 / K</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;}</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ad915026e49b0df9535ad8a75616ae267">  631</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordtype">double</span> air_temperature  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;{</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordtype">double</span> a = (18.678 - air_temperature / 234.5) * air_temperature;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordtype">double</span> b = 257.14 + air_temperature;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">return</span> 611.21 * exp(a / b);  <span class="comment">// Pa</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;}</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keyword">struct </span><a class="code" href="struct_e_t___str.html">ET_Str</a> <a class="code" href="_aux_bio_cro_8cpp.html#ad915026e49b0df9535ad8a75616ae267">EvapoTrans2</a>(</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    double absorbed_shortwave_radiation_et,  <span class="comment">// J / m^2 / s (used to calculate evapotranspiration rate)</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    double absorbed_shortwave_radiation_lt,  <span class="comment">// J / m^2 / s (used to calculate leaf temperature)</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    double airTemp,                          <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    double RH,                               <span class="comment">// dimensionless from Pa / Pa</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    double WindSpeed,                        <span class="comment">// m / s</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    double stomatal_conductance,             <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    double leaf_width,                       <span class="comment">// meter</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    double specific_heat_of_air,             <span class="comment">// J / kg / K</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    double minimum_gbw,                      <span class="comment">// mol / m^2 / s</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    int eteq                                 <span class="comment">// unitless parameter</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;{</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> DdryA = <a class="code" href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a>(airTemp);               <span class="comment">// kg / m^3. Density of dry air.,</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> LHV = <a class="code" href="_aux_bio_cro_8cpp.html#a460579178484521ecc50b488c58bb0dd">TempToLHV</a>(airTemp);                   <span class="comment">// J / kg</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> SlopeFS = <a class="code" href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a>(airTemp);               <span class="comment">// kg / m^3 / K</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> SWVP = <a class="code" href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(airTemp);  <span class="comment">// Pa.</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="comment">// TODO: This is for about 20 degrees C at 100000 Pa. Change it to use the</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="comment">// model state. (1 * R * temperature) / pressure</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordtype">double</span> constexpr volume_of_one_mole_of_air = 24.39e-3;  <span class="comment">// m^3 / mol</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordtype">double</span> minimum_gbw_in_m_per_s = minimum_gbw * volume_of_one_mole_of_air;  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">if</span> (stomatal_conductance &lt;= 0) {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: stomatal conductance is not positive.&quot;</span>);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordtype">double</span> conductance_in_m_per_s = stomatal_conductance * 1e-3 * volume_of_one_mole_of_air;  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">if</span> (RH &gt; 1) {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: RH (relative humidity) is greater than 1.&quot;</span>);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">// Convert from vapor pressure to vapor density using the ideal gas law.</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">// This is approximately right for temperatures what won&#39;t kill plants.</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> SWVC =</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        SWVP / physical_constants::ideal_gas_constant /</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        (airTemp + conversion_constants::celsius_to_kelvin) * physical_constants::molar_mass_of_water;  <span class="comment">// kg / m^3</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">if</span> (SWVC &lt; 0) {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: SWVC is less than 0.&quot;</span>);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> PsycParam = DdryA * specific_heat_of_air / LHV;  <span class="comment">// kg / m^3 / K</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> vapor_density_deficit = SWVC * (1 - RH);  <span class="comment">// kg / m^3</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> ActualVaporPressure = RH * SWVP;  <span class="comment">// Pa</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">/* This is the original from WIMOVAC*/</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a> = 0.01;  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordtype">double</span> ga;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordtype">double</span> rlc; <span class="comment">/* Long wave radiation for iterative calculation */</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordtype">double</span> ChangeInLeafTemp = 10.0;  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordtype">double</span> Counter = 0;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            ga = <a class="code" href="_aux_bio_cro_8cpp.html#a7ffa2369991fbb92c2cf4fef41743e49">leaf_boundary_layer_conductance_nikolov</a>(</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                WindSpeed, leaf_width, airTemp, <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>, conductance_in_m_per_s,</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                ActualVaporPressure, minimum_gbw_in_m_per_s);  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="comment">/* In WIMOVAC, ga was added to the canopy conductance */</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            <span class="comment">/* ga = (ga * gbcW)/(ga + gbcW); */</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="keywordtype">double</span> OldDeltaT = <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            rlc = 4 * physical_constants::stefan_boltzmann * pow(conversion_constants::celsius_to_kelvin + airTemp, 3) * <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>;  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="comment">/* rlc = net long wave radiation emittted per second</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">             *     = radiation emitted per second - radiation absorbed per second</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">             *     = sigma * (Tair + deltaT)^4 - sigma * Tair^4</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">             *</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">             * To make it a linear function of deltaT, do a Taylor series about</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">             * deltaT = 0 and keep only the zero and first order terms.</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">             *</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">             * rlc = sigma * Tair^4 + deltaT * (4 * sigma * Tair^3) - sigma * Tair^4</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">             *     = 4 * sigma * Tair^3 * deltaT</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">             *</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">             * where 4 * sigma * Tair^3 is the derivative of</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">             * sigma * (Tair + deltaT)^4 evaluated at deltaT = 0</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> PhiN2 = absorbed_shortwave_radiation_lt - rlc;  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            <span class="comment">/* This equation is from Thornley and Johnson pg. 418 */</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> TopValue = PhiN2 * (1 / ga + 1 / conductance_in_m_per_s) - LHV * vapor_density_deficit;  <span class="comment">// J / m^3</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> BottomValue = LHV * (SlopeFS + PsycParam * (1 + ga / conductance_in_m_per_s));           <span class="comment">// J / m^3 / K</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a> = fmin(fmax(TopValue / BottomValue, -10), 10);                                                 <span class="comment">// kelvin. Confine Deltat to the interval [-10, 10]:</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            ChangeInLeafTemp = fabs(OldDeltaT - <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>);  <span class="comment">// kelvin</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        } <span class="keywordflow">while</span> ((++Counter &lt;= 10) &amp;&amp; (ChangeInLeafTemp &gt; 0.5));</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">/* Net radiation */</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> PhiN = fmax(0, absorbed_shortwave_radiation_et - rlc);  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> penman_monteith =</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        (SlopeFS * PhiN + LHV * PsycParam * ga * vapor_density_deficit) /</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        (LHV * (SlopeFS + PsycParam * (1 + ga / conductance_in_m_per_s)));  <span class="comment">// kg / m^2 / s.  Thornley and Johnson. 1990. Plant and Crop Modeling. Equation 14.4k. Page 408.</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> EPen =</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        (SlopeFS * PhiN + LHV * PsycParam * ga * vapor_density_deficit) /</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> EPries = 1.26 * SlopeFS * PhiN / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">/* Choose equation to report */</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">switch</span> (eteq) {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = EPen;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = EPries;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = penman_monteith;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="comment">// TransR has units of kg / m^2 / s. Convert to mmol / m^2 / s using the</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="comment">// molar mass of water (in kg / mol) and noting that 1e3 mmol = 1 mol</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keywordtype">double</span> cf = 1e3 / physical_constants::molar_mass_of_water;  <span class="comment">// mmol / kg for water</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_e_t___str.html">ET_Str</a> et_results;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    et_results.<a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> * cf;                                         <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    et_results.EPenman = EPen * cf;                                          <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    et_results.EPriestly = EPries * cf;                                      <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    et_results.Deltat = <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>;                                              <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    et_results.boundary_layer_conductance = ga / volume_of_one_mole_of_air;  <span class="comment">// mol / m^2 / s</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">return</span> et_results;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;}</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a7ffa2369991fbb92c2cf4fef41743e49">  824</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a7ffa2369991fbb92c2cf4fef41743e49">leaf_boundary_layer_conductance_nikolov</a>(</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordtype">double</span> windspeed,             <span class="comment">// m / s</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordtype">double</span> leafwidth,             <span class="comment">// m</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordtype">double</span> air_temperature,       <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordtype">double</span> delta_t,               <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordtype">double</span> stomcond,              <span class="comment">// m / s</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordtype">double</span> water_vapor_pressure,  <span class="comment">// Pa</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordtype">double</span> minimum_gbw            <span class="comment">// m / s</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;{</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    constexpr <span class="keywordtype">double</span> p = physical_constants::atmospheric_pressure_at_sea_level;  <span class="comment">// Pa</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordtype">double</span> leaftemp = air_temperature + delta_t;                             <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordtype">double</span> gsv = stomcond;                                                   <span class="comment">// m / s</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordtype">double</span> Tak = air_temperature + conversion_constants::celsius_to_kelvin;  <span class="comment">// K</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordtype">double</span> Tlk = leaftemp + conversion_constants::celsius_to_kelvin;         <span class="comment">// K</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordtype">double</span> ea = water_vapor_pressure;                                        <span class="comment">// Pa</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordtype">double</span> lw = leafwidth;                                                   <span class="comment">// m</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordtype">double</span> esTl = <a class="code" href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(leaftemp);  <span class="comment">// Pa.</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">// Forced convection</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    constexpr <span class="keywordtype">double</span> cf = 1.6361e-3;  <span class="comment">// TODO: Nikolov et. al equation 29 use cf = 4.322e-3, not cf = 1.6e-3 as is used here.</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordtype">double</span> gbv_forced = cf * pow(Tak, 0.56) * pow((Tak + 120) * ((windspeed / lw) / p), 0.5);  <span class="comment">// m / s.</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="comment">// Free convection</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordtype">double</span> gbv_free = gbv_forced;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordtype">double</span> eb = (gsv * esTl + gbv_free * ea) / (gsv + gbv_free);  <span class="comment">// Pa. Eq 35</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordtype">double</span> Tvdiff = (Tlk / (1 - 0.378 * eb / p)) - (Tak / (1 - 0.378 * ea / p));  <span class="comment">// kelvin. It is also degrees C since it is a temperature difference. Eq. 34</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">if</span> (Tvdiff &lt; 0) Tvdiff = -Tvdiff;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    gbv_free = cf * pow(Tlk, 0.56) * pow((Tlk + 120) / p, 0.5) * pow(Tvdiff / lw, 0.25);  <span class="comment">// m / s. Eq. 33</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">// Overall conductance</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordtype">double</span> gbv = std::max(gbv_forced, gbv_free);  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// Apply the minimum</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">return</span> std::max(gbv, minimum_gbw);  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;}</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a33949e3620b40eedec427390bde216f0">  917</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a33949e3620b40eedec427390bde216f0">leaf_boundary_layer_conductance_thornley</a>(</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordtype">double</span> CanopyHeight,    <span class="comment">// m</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordtype">double</span> WindSpeed,       <span class="comment">// m / s</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordtype">double</span> minimum_gbw,     <span class="comment">// m / s</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordtype">double</span> WindSpeedHeight  <span class="comment">// m</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;{</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="comment">// Define constants used in the model</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    constexpr <span class="keywordtype">double</span> kappa = 0.41;         <span class="comment">// dimensionless. von Karmon&#39;s constant. Thornley and Johnson pgs 414 and 416.</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    constexpr <span class="keywordtype">double</span> ZetaCoef = 0.026;     <span class="comment">// dimensionless, Thornley and Johnson 1990, Eq. 14.9o</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    constexpr <span class="keywordtype">double</span> ZetaMCoef = 0.13;     <span class="comment">// dimensionless, Thornley and Johnson 1990, Eq. 14.9o</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    constexpr <span class="keywordtype">double</span> dCoef = 0.77;         <span class="comment">// dimensionless, Thornley and Johnson 1990, Eq. 14.9o.</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                           <span class="comment">// In the original text this value is reported as 0.64.</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                                           <span class="comment">// In the 2000 reprinting of this text, the authors state that this value should be 0.77.</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                                           <span class="comment">// See &quot;Errata to the 2000 printing&quot; on the page after the preface of the 2000 reprinting of the 1990 text.</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="comment">// Apply the height limit</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    CanopyHeight = std::min(CanopyHeight, 0.98 * WindSpeedHeight);  <span class="comment">// meters</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="comment">// Calculate terms that depend on the canopy height</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> Zeta = ZetaCoef * CanopyHeight;    <span class="comment">// meters</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> Zetam = ZetaMCoef * CanopyHeight;  <span class="comment">// meters</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> d = dCoef * CanopyHeight;          <span class="comment">// meters</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="comment">// Calculate the boundary layer conductance `ga` according to Thornley and</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="comment">// Johnson Eq. 14.9n, pg. 416</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> ga0 = pow(kappa, 2) * WindSpeed;                   <span class="comment">// m / s</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> ga1 = log((WindSpeedHeight + Zeta - d) / Zeta);    <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> ga2 = log((WindSpeedHeight + Zetam - d) / Zetam);  <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> gbv = ga0 / (ga1 * ga2);                           <span class="comment">// m / s</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="comment">// Apply the minimum</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">return</span> std::max(gbv, minimum_gbw);  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;}</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">/* Soil Evaporation Function */</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">/* Variables I need */</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">/* LAI = Leaf Area Index */</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">/* k = extinction coefficient */</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">/* ppfd = Photosynthetic photon flux density */</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">/* awc, wiltp, fieldc = available water content, wilting point and field capacity */</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">/* winds = wind speed */</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ab163aedfdfb73c66e5eb8dca307016be">  960</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ab163aedfdfb73c66e5eb8dca307016be">SoilEvapo</a>(</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordtype">double</span> LAI, <span class="keywordtype">double</span> k, <span class="keywordtype">double</span> air_temperature, <span class="keywordtype">double</span> ppfd,</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordtype">double</span> soil_water_content, <span class="keywordtype">double</span> fieldc, <span class="keywordtype">double</span> wiltp, <span class="keywordtype">double</span> winds,</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordtype">double</span> RelH, <span class="keywordtype">double</span> rsec, <span class="keywordtype">double</span> soil_clod_size, <span class="keywordtype">double</span> soil_reflectance,</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordtype">double</span> soil_transmission, <span class="keywordtype">double</span> specific_heat_of_air,</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordtype">double</span> par_energy_content)</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;{</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordtype">int</span> method = 1;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="comment">/* A simple way of calculating the proportion of the soil that is hit by direct radiation. */</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordtype">double</span> soil_area_sunlit_fraction = exp(-k * LAI);  <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">/* For now the temperature of the soil will be the same as the air.</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">       At a later time this can be made more accurate. I looked at the equations for this and the issue is that it is strongly dependent on</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">       depth. Since the soil model now has a single layer, this cannot be implemented correctly at the moment.  */</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordtype">double</span> SoilTemp = air_temperature;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">/* From Campbell and Norman. Environmental Biophysics. */</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">/* If relative available water content is */</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordtype">double</span> rawc = (soil_water_content - wiltp) / (fieldc - wiltp);  <span class="comment">// dimensionless. relative available water content.</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">/* Campbell and Norman. Environmental Physics, page 142 */</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordtype">double</span> maximum_uptake_rate = 1 - pow((1 + 1.3 * rawc), -5);  <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="comment">/* This is a useful idea because dry soils evaporate little water when dry*/</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">/* Total Radiation */</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">/* At the moment soil evaporation is grossly overestimated. In WIMOVAC the light reaching the last layer of leaves is used. Here instead</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">       of calculating this again, I will for now assume a 10% as a rough estimate. Note that I could maybe get this since layIdir and</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">       layIDiff in sunML are external variables.  Rprintf(&quot;ppfd %.5f&quot;,layIdir[0],&quot;\n&quot;); Update: 03-13-2009. I tried printing this</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">       value but it is still too high and will likely overestimate soil evaporation. However, this is still a work in progress.</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">       */</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    ppfd *= rsec; <span class="comment">/* Radiation soil evaporation coefficient */</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordtype">double</span> TotalRadiation = ppfd * par_energy_content;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160; </div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordtype">double</span> DdryA = <a class="code" href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a>(air_temperature);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordtype">double</span> LHV = <a class="code" href="_aux_bio_cro_8cpp.html#a460579178484521ecc50b488c58bb0dd">TempToLHV</a>(air_temperature);  <span class="comment">// J / kg</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordtype">double</span> SlopeFS = <a class="code" href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a>(air_temperature);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordtype">double</span> SWVC = <a class="code" href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(air_temperature) * 1e-5;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordtype">double</span> PsycParam = (DdryA * specific_heat_of_air) / LHV;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordtype">double</span> vapor_density_deficit = SWVC * (1 - RelH / 100);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160; </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="keywordtype">double</span> BoundaryLayerThickness = 4e-3 * sqrt(soil_clod_size / winds);</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordtype">double</span> DiffCoef = 2.126e-5 + 1.48e-7 * SoilTemp;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordtype">double</span> SoilBoundaryLayer = DiffCoef / BoundaryLayerThickness;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordtype">double</span> Ja = 2 * TotalRadiation * ((1 - soil_reflectance - soil_transmission) / (1 - soil_transmission));</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keywordtype">double</span> rlc = 4 * physical_constants::stefan_boltzmann * pow((conversion_constants::celsius_to_kelvin + SoilTemp), 3) * 0.005;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="comment">/* the last term should be the difference between air temperature and soil. This is not actually calculated at the moment. Since this is</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">       mostly relevant to the first soil layer where the temperatures are similar. I will leave it like this for now. */</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordtype">double</span> PhiN = Ja - rlc; <span class="comment">/* Calculate the net radiation balance*/</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordflow">if</span> (PhiN &lt; 0) PhiN = 1e-7;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordtype">double</span> Evaporation = 0.0;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keywordflow">if</span> (method == 0) {</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="comment">/* Priestly-Taylor */</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        Evaporation = 1.26 * (SlopeFS * PhiN) / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="comment">/* Penman-Monteith */</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        Evaporation = (SlopeFS * PhiN + LHV * PsycParam * SoilBoundaryLayer * vapor_density_deficit) / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    Evaporation *= soil_area_sunlit_fraction * maximum_uptake_rate;  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span> (Evaporation &lt; 0) Evaporation = 1e-6;  <span class="comment">// Prevent odd values at very low light levels.</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">return</span> Evaporation;  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;}</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a058be0e6ed718b377d7c6056cceb09a8"> 1030</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a058be0e6ed718b377d7c6056cceb09a8">compute_wsPhoto</a>(<span class="keywordtype">int</span> wsFun, <span class="keywordtype">double</span> fieldc, <span class="keywordtype">double</span> wiltp, <span class="keywordtype">double</span> phi1, <span class="keywordtype">double</span> awc) {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="comment">// Three different type of equations for modeling the effect of</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="comment">// water stress on vmax and leaf area expansion.  The equation for</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="comment">// leaf area expansion is more severe than the one for vmax. */</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordtype">double</span> wsPhoto;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">switch</span> (wsFun) {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordflow">case</span> 0: { <span class="comment">/* linear */</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="keywordtype">double</span> slp = 1 / (fieldc - wiltp);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keywordtype">double</span> intcpt = 1 - fieldc * slp;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        wsPhoto = slp * awc + intcpt;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">case</span> 1: {</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordtype">double</span> phi10 = (fieldc + wiltp) / 2;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        wsPhoto = 1 / (1 + exp((phi10 - awc) / phi1));</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    }</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">case</span> 2: {</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="keywordtype">double</span> slp = (1 - wiltp) / (fieldc - wiltp);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keywordtype">double</span> intcpt = 1 - fieldc * slp;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keywordtype">double</span> theta = slp * awc + intcpt;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        wsPhoto = (1 - exp(-2.5 * (theta - wiltp)/(1 - wiltp))) / (1 - exp(-2.5));</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    }</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        wsPhoto = 1;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        wsPhoto = 0;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    }</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="comment">// wsPhoto can be mathematically lower than zero in some cases but</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="comment">// I should prevent that:</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keywordflow">if</span> (wsPhoto &lt;= 0) {</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        wsPhoto = 1e-10;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    }</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">// Apparently wsPhoto can be greater than 1.</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (wsPhoto &gt; 1) wsPhoto = 1;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">return</span> wsPhoto;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;}</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">/* This is a new function that attempts to keep a water budget and then</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">   calcualte an empirical coefficient that reduces the specific leaf area.</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">   This results from the general idea that water stress reduces first the</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">   rate of leaf expansion. */</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">/* This is meant to be a simple function that calculates a</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">   simple empirical coefficient that reduces specifi leaf area</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">   according to the water stress of the plant. This is done</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">   for now, with a very simple empirical approach. */</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="keyword">struct </span><a class="code" href="structws__str.html">ws_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#a3e42b1f6357490f2be99959174fe503f">watstr</a>(double precipit, double evapo, double cws, double soildepth, double fieldc,</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                     double wiltp, double soil_saturation_capacity, double <a class="code" href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1a88336b5bb2a1cc21bac7cf33fd451270">sand</a>,</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                     double Ks, double air_entry, double b)</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;{</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    constexpr <span class="keywordtype">double</span> g = 9.8; <span class="comment">// m / s^2  ##  http://en.wikipedia.org/wiki/Standard_gravity</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordtype">double</span> precipM = precipit * 1e-3; <span class="comment">/* convert precip in mm to m*/</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordtype">double</span> soil_water_fraction = precipM / soildepth + cws;  <span class="comment">// m^3 m^-3</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> = 0.0;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = 0.0;  <span class="comment">/* Nleach is the NO3 leached. */</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordflow">if</span> (soil_water_fraction &gt; soil_saturation_capacity) {</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> = (soil_water_fraction - soil_saturation_capacity) * soildepth; <span class="comment">/* This is in meters */</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="comment">/* Here runoff is interpreted as water content exceeding saturation level */</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <span class="comment">/* Need to convert to units used in the Parton et al 1988 paper. */</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <span class="comment">/* The data come in mm/hr and need to be in cm/month */</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <a class="code" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = <a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> / (1e3 * physical_constants::molar_mass_of_water) * (0.2 + 0.7 * <a class="code" href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1a88336b5bb2a1cc21bac7cf33fd451270">sand</a>);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        soil_water_fraction = soil_saturation_capacity;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160; </div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">/* The density of water is 0.9982 Mg / m^3 at 20 degrees Celsius. */</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="comment">/* evapo is demanded water (Mg / ha) */</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordtype">double</span> npaw = soil_water_fraction - wiltp - evapo / 0.9982 / 1e4 / soildepth;  <span class="comment">// fraction of saturation.</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="comment">/* If demand exceeds supply, the crop is getting close to wilting point and transpiration</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">       will be over estimated. In this one layer model though, the crop is practically dead. */</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordflow">if</span> (npaw &lt; 0) npaw = 0.0;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> = npaw + wiltp;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="comment">/* Calculating the soil water potential based on equations from Norman and Campbell */</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="comment">/* tmp.psim = soTexS.air_entry * pow((awc/soTexS.fieldc*1.1),-soTexS.b); */</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="comment">/* New version of the soil water potential is based on</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">     * &quot;Dynamic Simulation of Water Deficit Effects upon Maize Yield&quot; R. F. Grant Agricultural Systems. 33(1990) 13-39. */</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <a class="code" href="structws__str.html">ws_str</a> tmp;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    tmp.<a class="code" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a> = -exp(log(0.033) + (log(fieldc) - log(<a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a>)) / (log(fieldc) - log(wiltp)) * (log(1.5) - log(0.033))) * 1e3; <span class="comment">/* This last term converts from MPa to kPa */</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="comment">/* This is drainage */</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> &gt; fieldc) {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        <span class="keywordtype">double</span> K_psim = Ks * pow((air_entry / tmp.<a class="code" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a>), 2 + 3 / b); <span class="comment">/* This is hydraulic conductivity */</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="keywordtype">double</span> J_w = -K_psim * (-tmp.<a class="code" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a> / (soildepth * 0.5)) - g * K_psim; <span class="comment">/*  Campbell, pg 129 do not ignore the graviational effect. I multiply soil depth by 0.5 to calculate the average depth */</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="keywordtype">double</span> drainage = J_w * 3600 * 0.9982 * 1e-3; <span class="comment">/* This is flow in m^3 / (m^2 * hr). */</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> = <a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> + drainage / soildepth;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    }</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    tmp.<a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> = <a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a>;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    tmp.<a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> = <a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a>;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    tmp.<a class="code" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = <a class="code" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a>;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <span class="keywordflow">return</span> tmp;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;}</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">/* Function to simulate the multilayer behavior of soil water. In the</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">   future this could be coupled with Campbell (BASIC) ideas to</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">   esitmate water potential. */</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="keyword">struct </span><a class="code" href="structsoil_m_l__str.html">soilML_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#a109fb8f39e5145b8716a494dc13e2db5">soilML</a>(double precipit, double transp, double *<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>, <span class="keywordtype">double</span> soildepth, <span class="keywordtype">double</span> *depths,</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="keywordtype">double</span> soil_field_capacity, <span class="keywordtype">double</span> soil_wilting_point, <span class="keywordtype">double</span> soil_saturation_capacity, <span class="keywordtype">double</span> soil_air_entry, <span class="keywordtype">double</span> soil_saturated_conductivity,</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        <span class="keywordtype">double</span> soil_b_coefficient, <span class="keywordtype">double</span> soil_sand_content, <span class="keywordtype">double</span> phi1, <span class="keywordtype">double</span> phi2, <span class="keywordtype">int</span> wsFun,</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="keywordtype">int</span> layers, <span class="keywordtype">double</span> rootDB, <span class="keywordtype">double</span> LAI, <span class="keywordtype">double</span> k, <span class="keywordtype">double</span> AirTemp,</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="keywordtype">double</span> IRad, <span class="keywordtype">double</span> winds, <span class="keywordtype">double</span> RelH, <span class="keywordtype">int</span> hydrDist, <span class="keywordtype">double</span> rfl,</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <span class="keywordtype">double</span> rsec, <span class="keywordtype">double</span> rsdf, <span class="keywordtype">double</span> soil_clod_size, <span class="keywordtype">double</span> soil_reflectance, <span class="keywordtype">double</span> soil_transmission,</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keywordtype">double</span> specific_heat_of_air, <span class="keywordtype">double</span> par_energy_content)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;{</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    constexpr <span class="keywordtype">double</span> g = 9.8; <span class="comment">/* m / s-2  ##  http://en.wikipedia.org/wiki/Standard_gravity */</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <a class="code" href="structsoil_m_l__str.html">soilML_str</a> return_value;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">/* Crude empirical relationship between root biomass and rooting depth*/</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordtype">double</span> rootDepth = fmin(rootDB * rsdf, soildepth);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160; </div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <a class="code" href="structrd__str.html">rd_str</a> root_distribution = <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>(layers, rootDepth, &amp;depths[0], rfl);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160; </div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="comment">/* unit conversion for precip */</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordtype">double</span> oldWaterIn = 0.0;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordtype">double</span> waterIn = precipit * 1e-3; <span class="comment">/* convert precip in mm to m */</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> = 0.0;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordtype">double</span> wsPhotoCol = 0.0;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordtype">double</span> LeafWSCol = 0.0;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keywordtype">double</span> Sevap = 0.0;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="keywordtype">double</span> oldEvapoTra = 0.0;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = layers - 1; i &gt;= 0; --i) { <span class="comment">/* The counter, i, decreases because I increase the water content due to precipitation in the last layer first*/</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="keywordtype">double</span> layerDepth = depths[i+1] - depths[i];  <span class="comment">/* This supports unequal depths. */</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; </div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <span class="keywordflow">if</span> (hydrDist &gt; 0) {</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;            <span class="comment">/* For this section see Campbell and Norman &quot;Environmental BioPhysics&quot; Chapter 9*/</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            <span class="comment">/* First compute the matric potential */</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            <span class="keywordtype">double</span> psim1 = soil_air_entry * pow((<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i]/soil_saturation_capacity), -soil_b_coefficient); <span class="comment">/* This is matric potential of current layer */</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            <span class="keywordtype">double</span> dPsim;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                <span class="keywordtype">double</span> psim2 = soil_air_entry * pow((<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i-1]/soil_saturation_capacity), -soil_b_coefficient); <span class="comment">/* This is matric potential of next layer */</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                dPsim = psim1 - psim2;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                <span class="comment">/* The substraction is from the layer i - (i-1). If this last term is positive then it will move upwards. If it is negative it will move downwards. Presumably this term is almost always positive. */</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                dPsim = 0.0;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            <span class="keywordtype">double</span> K_psim = soil_saturated_conductivity * pow((soil_air_entry/psim1), 2+3/soil_b_coefficient); <span class="comment">/* This is hydraulic conductivity */</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            <span class="keywordtype">double</span> J_w = K_psim * (dPsim/layerDepth) - g * K_psim; <span class="comment">/*  Campbell, pg 129 do not ignore the graviational effect*/</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            <span class="comment">/* Notice that K_psim is positive because my reference system is reversed */</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            <span class="comment">/* This last result should be in kg/(m2 * s) */</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            J_w *= 3600 * 0.9882 * 1e-3; <span class="comment">/* This is flow in m3 / (m^2 * hr). */</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            <span class="keywordflow">if</span> (i == (layers-1) &amp;&amp; J_w &lt; 0) {</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                <span class="comment">/* cws[i] = cws[i] + J_w / layerDepth; Although this should be done it drains the last layer too much.*/</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> += J_w;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                    <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] - J_w / layerDepth;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                    <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i - 1] = <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i - 1] + J_w / layerDepth;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        }</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] &gt; soil_saturation_capacity) <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = soil_saturation_capacity;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] &lt; soil_wilting_point) <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = soil_wilting_point;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        <span class="comment">// Here is a convention aw is available water in volume and awc</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        <span class="comment">// is available water content as a fraction of the soil section being investigated.</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <span class="keywordtype">double</span> aw = <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] * layerDepth;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="comment">/* Available water (for this layer) is the current water status times the layer depth */</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160; </div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="keywordflow">if</span> (waterIn &gt; 0) {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            <span class="comment">/* There is some rain. Need to add it.*/</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            aw += waterIn / layers + oldWaterIn; <span class="comment">/* They are both in meters so it works */</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            <span class="comment">/* Adding the same amount to water to each layer */</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="comment">/* In case there is overflow */</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            <span class="keywordtype">double</span> diffw = soil_field_capacity * layerDepth - aw;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            <span class="keywordflow">if</span> (diffw &lt; 0) {</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                <span class="comment">/* This means that precipitation exceeded the capacity of the first layer */</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                <span class="comment">/* Save this amount of water for the next layer */</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                oldWaterIn = -diffw;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                aw = soil_field_capacity * layerDepth;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                oldWaterIn = 0.0;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        <span class="comment">/* Root Biomass */</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        <span class="keywordtype">double</span> rootATdepth = rootDB * root_distribution.<a class="code" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i];</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        return_value.<a class="code" href="structsoil_m_l__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i] = rootATdepth;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <span class="comment">/* Plant available water is only between current water status and permanent wilting point */</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <span class="comment">/* Plant available water */</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        <span class="keywordtype">double</span> pawha = (aw - soil_wilting_point * layerDepth) * 1e4;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <span class="keywordflow">if</span> (pawha &lt; 0) pawha = 0;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordtype">double</span> Ctransp = 0.0;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordtype">double</span> EvapoTra = 0.0;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordtype">double</span> Newpawha;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <span class="comment">/* Only the first layer is affected by soil evaporation */</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            <span class="keywordtype">double</span> awc2 = aw / layerDepth;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;            <span class="comment">/* SoilEvapo function needs soil water content  */</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;            Sevap = <a class="code" href="_aux_bio_cro_8cpp.html#ab163aedfdfb73c66e5eb8dca307016be">SoilEvapo</a>(</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                LAI, k, AirTemp, IRad, awc2, soil_field_capacity,</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                soil_wilting_point, winds, RelH, rsec, soil_clod_size,</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                soil_reflectance, soil_transmission, specific_heat_of_air,</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                par_energy_content) * 3600 * 1e-3 * 10000;  <span class="comment">// Mg / ha / hr. 3600 s / hr * 1e-3 Mg / kg * 10000 m^2 / ha.</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            <span class="comment">/* I assume that crop transpiration is distributed simlarly to</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="comment">               root density.  In other words the crop takes up water proportionally</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">               to the amount of root in each respective layer.*/</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;            Ctransp = transp * root_distribution.<a class="code" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[0];</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;            EvapoTra = Ctransp + Sevap;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            constexpr <span class="keywordtype">double</span> density_of_water_at_20_celcius = 0.9982;  <span class="comment">// Mg m^-3.</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;            Newpawha = pawha - EvapoTra / density_of_water_at_20_celcius;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;            <span class="comment">/* The first term in the rhs pawha is the m3 of water available in this layer.</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">               EvapoTra is the Mg H2O ha-1 of transpired and evaporated water. 1/0.9882 converts from Mg to m3 */</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;            Ctransp = transp * root_distribution.<a class="code" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i];</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;            EvapoTra = Ctransp;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            Newpawha = pawha - (EvapoTra + oldEvapoTra);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        <span class="keywordflow">if</span> (Newpawha &lt; 0) {</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;            <span class="comment">/* If the Demand is not satisfied by this layer. This will be stored and added to subsequent layers*/</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;            oldEvapoTra = -Newpawha;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            aw = soil_wilting_point * layerDepth;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        }</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160; </div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <span class="keywordtype">double</span> awc = Newpawha / 1e4 / layerDepth + soil_wilting_point;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="comment">/* This might look like a weird place to populate the structure, but is more convenient*/</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        return_value.<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = awc;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="comment">// To-do: Replace this block with a call to compute_wsPhoto.</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="comment">/* three different type of equations for modeling the effect of water stress on vmax and leaf area expansion.</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">       The equation for leaf area expansion is more severe than the one for vmax. */</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordtype">double</span> wsPhoto = 0.0;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        <span class="keywordtype">double</span> slp = 0.0;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        <span class="keywordtype">double</span> intcpt = 0.0;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <span class="keywordtype">double</span> theta = 0.0;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="keywordflow">if</span> (wsFun == 0) { <span class="comment">/* linear */</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            slp = 1/(soil_field_capacity - soil_wilting_point);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            intcpt = 1 - soil_field_capacity * slp;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;            wsPhoto = slp * awc + intcpt;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 1) {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            <span class="keywordtype">double</span> phi10 = (soil_field_capacity + soil_wilting_point)/2;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            wsPhoto = 1/(1 + exp((phi10 - awc)/ phi1));</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 2) {</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;            slp = (1 - soil_wilting_point)/(soil_field_capacity - soil_wilting_point);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            intcpt = 1 - soil_field_capacity * slp;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            theta = slp * awc + intcpt;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;            wsPhoto = (1 - exp(-2.5 * (theta - soil_wilting_point)/(1 - soil_wilting_point))) / (1 - exp(-2.5));</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 3) {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            wsPhoto = 1;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        }</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160; </div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="keywordflow">if</span> (wsPhoto &lt;= 0 )</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            wsPhoto = 1e-10; <span class="comment">/* This can be mathematically lower than zero in some cases but I should prevent that. */</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160; </div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        wsPhotoCol += wsPhoto;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160; </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="keywordtype">double</span> LeafWS = pow(awc, phi2) * 1/pow(soil_field_capacity, phi2);</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="keywordflow">if</span> (wsFun == 3) {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            LeafWS = 1;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        }</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        LeafWSCol += LeafWS;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    }</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160; </div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">if</span> (waterIn &gt; 0) {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> = waterIn;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="comment">/* Need to convert to units used in the Parton et al 1988 paper. */</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="comment">/* The data comes in mm/hr and it needs to be in cm/month */</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        return_value.<a class="code" href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> * 0.1 * (1/24 * 30) / (1e3 * physical_constants::molar_mass_of_water * (0.2 + 0.7 * soil_sand_content));</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    }</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        return_value.<a class="code" href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = 0.0;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    }</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    return_value.<a class="code" href="structsoil_m_l__str.html#a50be45bf1a7676b85f348d2a38d900b7">rcoefPhoto</a> = (wsPhotoCol/layers);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    return_value.<a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> = <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a>;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    return_value.<a class="code" href="structsoil_m_l__str.html#aff37ff3493aa80130290d80445e09c03">rcoefSpleaf</a> = (LeafWSCol/layers);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    return_value.<a class="code" href="structsoil_m_l__str.html#a1181d419ee6ec88951ccc5d991626005">SoilEvapo</a> = Sevap;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">return</span> return_value;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;}</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01425"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ac0cb91d103489dd5260fe85905dbcde9"> 1425</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ac0cb91d103489dd5260fe85905dbcde9">resp</a>(<span class="keywordtype">double</span> base_rate, <span class="keywordtype">double</span> mrc, <span class="keywordtype">double</span> temp) {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordtype">double</span> ans = base_rate *  (1 - (mrc * pow(2, (temp / 10.0))));</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160; </div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordflow">if</span> (ans &lt;0) ans = 0;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160; </div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160; </div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;}</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160; </div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="keyword">struct </span><a class="code" href="structseq_r_d__str.html">seqRD_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#a668682ce55f6888ab3ec44a7d7a48d07">seqRootDepth</a>(double to, int lengthOut ) {</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keywordtype">double</span> by = to / lengthOut;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160; </div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keyword">struct </span><a class="code" href="structseq_r_d__str.html">seqRD_str</a> result;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= lengthOut; ++i) {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        result.<a class="code" href="structseq_r_d__str.html#a510f69db6ac897b84a1d62973c365234">rootDepths</a>[i] = i * by;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    }</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;}</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="keyword">struct </span><a class="code" href="structrd__str.html">rd_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>(int n_layers, double rootDepth, double *depths, <span class="keywordtype">double</span> rfl)</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;{</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">     * Calculate the fraction of total root mass for each layer in `depths` assuming the mass</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment">     * is follows a Poisson distribution along the depth.</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">     * Returns a struct with one array of size `n_layers`.</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment">     * Each element in the array is the fraction of total root mass in that layer.</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment">     * The sum of all elements of the result equals 1.</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordtype">double</span> layerDepth = 0.0;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordtype">double</span> CumLayerDepth = 0.0;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="keywordtype">int</span> CumRootDist = 1;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>[n_layers];</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordtype">double</span> cumulative_a = 0.0;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160; </div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n_layers; ++i) {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            layerDepth = depths[1];</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            layerDepth = depths[i] - depths[i-1];</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        }</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160; </div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        CumLayerDepth += layerDepth;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160; </div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordflow">if</span> (rootDepth &gt; CumLayerDepth) {</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            CumRootDist++;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    }</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n_layers; ++j) {</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        <span class="keywordflow">if</span> (j &lt; CumRootDist) {</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            <span class="keywordtype">double</span> a = <a class="code" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a>(j + 1, (<span class="keywordtype">double</span>)CumRootDist * rfl);</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>[j] = a;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            cumulative_a += a;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>[j] = 0;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        }</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    }</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160; </div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keyword">struct </span><a class="code" href="structrd__str.html">rd_str</a> result;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; n_layers; ++k) {</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        result.<a class="code" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[k] = <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>[k] / cumulative_a;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    }</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keywordflow">return</span>  result;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;}</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160; </div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c"> 1493</a></span>&#160;<a class="code" href="structsoil_text__str.html">soilText_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c">get_soil_properties</a>(<span class="keywordtype">int</span> soiltype) {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c">get_soil_properties</a>(<span class="keyword">static_cast&lt;</span><a class="code" href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1">SoilType</a><span class="keyword">&gt;</span>(soiltype));</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;}</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160; </div>
<div class="line"><a name="l01497"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#af355fd8964ae8eef5aad1c74a4ed0771"> 1497</a></span>&#160;<span class="keyword">const</span> <a class="code" href="structsoil_text__str.html">soilText_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c">get_soil_properties</a>(<a class="code" href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1">SoilType</a> soiltype)</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;{</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_aux_bio_cro_8h.html#a132d736e080fb28f7c4fde8561b02934">soil_parameters</a>.at(soiltype);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;}</div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a058be0e6ed718b377d7c6056cceb09a8"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a058be0e6ed718b377d7c6056cceb09a8">compute_wsPhoto</a></div><div class="ttdeci">double compute_wsPhoto(int wsFun, double fieldc, double wiltp, double phi1, double awc)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01030">AuxBioCro.cpp:1030</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a05f381bbff6170709a8d0e2e34f4556a"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a></div><div class="ttdeci">double TempToSFS(double air_temperature)</div><div class="ttdoc">Determine the derivative of saturation water vapor pressure with respect to temperature at a particul...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00601">AuxBioCro.cpp:601</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a109fb8f39e5145b8716a494dc13e2db5"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a109fb8f39e5145b8716a494dc13e2db5">soilML</a></div><div class="ttdeci">struct soilML_str soilML(double precipit, double transp, double *cws, double soildepth, double *depths, double soil_field_capacity, double soil_wilting_point, double soil_saturation_capacity, double soil_air_entry, double soil_saturated_conductivity, double soil_b_coefficient, double soil_sand_content, double phi1, double phi2, int wsFun, int layers, double rootDB, double LAI, double k, double AirTemp, double IRad, double winds, double RelH, int hydrDist, double rfl, double rsec, double rsdf, double soil_clod_size, double soil_reflectance, double soil_transmission, double specific_heat_of_air, double par_energy_content)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01030">AuxBioCro.cpp:1138</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a117fba2c85ba6d52345e7cefc05a43ff"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a></div><div class="ttdeci">double saturation_vapor_pressure(double air_temperature)</div><div class="ttdoc">Determine saturation water vapor pressure (Pa) from air temperature (degrees C) using the Arden Buck ...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00631">AuxBioCro.cpp:631</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a2905c23b422ad454d9577841ca594d0d"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a2905c23b422ad454d9577841ca594d0d">LNprof</a></div><div class="ttdeci">void LNprof(double LeafN, double LAI, int nlayers, double kpLN, double *leafN_profile)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00457">AuxBioCro.cpp:457</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a33949e3620b40eedec427390bde216f0"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a33949e3620b40eedec427390bde216f0">leaf_boundary_layer_conductance_thornley</a></div><div class="ttdeci">double leaf_boundary_layer_conductance_thornley(double CanopyHeight, double WindSpeed, double minimum_gbw, double WindSpeedHeight)</div><div class="ttdoc">Caluclates the conductance for water vapor flow between the leaf surface and the atmosphere (AKA,...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00917">AuxBioCro.cpp:917</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a3e42b1f6357490f2be99959174fe503f"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a3e42b1f6357490f2be99959174fe503f">watstr</a></div><div class="ttdeci">struct ws_str watstr(double precipit, double evapo, double cws, double soildepth, double fieldc, double wiltp, double soil_saturation_capacity, double sand, double Ks, double air_entry, double b)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01030">AuxBioCro.cpp:1083</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a460579178484521ecc50b488c58bb0dd"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a460579178484521ecc50b488c58bb0dd">TempToLHV</a></div><div class="ttdeci">double TempToLHV(double temperature)</div><div class="ttdoc">Determine the latent heat of vaporization for water from its temperature.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00548">AuxBioCro.cpp:548</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a6380d8cd4192408df76baefe6b369a70"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a></div><div class="ttdeci">double TempToDdryA(double air_temperature)</div><div class="ttdoc">Determines the density of dry air from the air temperature.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00492">AuxBioCro.cpp:492</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a668682ce55f6888ab3ec44a7d7a48d07"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a668682ce55f6888ab3ec44a7d7a48d07">seqRootDepth</a></div><div class="ttdeci">struct seqRD_str seqRootDepth(double to, int lengthOut)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01425">AuxBioCro.cpp:1434</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a6979290fdcfafddf3aaa343a367c1f81"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a6979290fdcfafddf3aaa343a367c1f81">dry_air_density</a></div><div class="ttdeci">double dry_air_density(const double air_temperature, const double air_pressure)</div><div class="ttdoc">Calculate the density of dry air from temperature and pressure using the ideal gas law.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00511">AuxBioCro.cpp:511</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a7ffa2369991fbb92c2cf4fef41743e49"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a7ffa2369991fbb92c2cf4fef41743e49">leaf_boundary_layer_conductance_nikolov</a></div><div class="ttdeci">double leaf_boundary_layer_conductance_nikolov(double windspeed, double leafwidth, double air_temperature, double delta_t, double stomcond, double water_vapor_pressure, double minimum_gbw)</div><div class="ttdoc">Caluclates the conductance for water vapor flow between the leaf surface and the atmosphere (AKA,...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00824">AuxBioCro.cpp:824</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_aa4d2cdd07093428af4830f4c8afd660c"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#aa4d2cdd07093428af4830f4c8afd660c">RHprof</a></div><div class="ttdeci">void RHprof(double RH, int nlayers, double *relative_humidity_profile)</div><div class="ttdoc">Calculates a relative humidity profile throughout a multilayer canopy.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00438">AuxBioCro.cpp:438</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_aa642fb79dd7e9bc444cb8eae150fd64c"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#aa642fb79dd7e9bc444cb8eae150fd64c">sunML</a></div><div class="ttdeci">Light_profile sunML(double ambient_ppfd_beam, double ambient_ppfd_diffuse, double lai, int nlayers, double cosine_zenith_angle, double kd, double chil, double absorptivity, double heightf, double par_energy_content, double par_energy_fraction, double leaf_transmittance, double leaf_reflectance)</div><div class="ttdoc">Computes an n-layered light profile from the direct light, diffuse light, leaf area index,...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00185">AuxBioCro.cpp:185</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ab163aedfdfb73c66e5eb8dca307016be"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ab163aedfdfb73c66e5eb8dca307016be">SoilEvapo</a></div><div class="ttdeci">double SoilEvapo(double LAI, double k, double air_temperature, double ppfd, double soil_water_content, double fieldc, double wiltp, double winds, double RelH, double rsec, double soil_clod_size, double soil_reflectance, double soil_transmission, double specific_heat_of_air, double par_energy_content)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00960">AuxBioCro.cpp:960</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ac0cb91d103489dd5260fe85905dbcde9"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ac0cb91d103489dd5260fe85905dbcde9">resp</a></div><div class="ttdeci">double resp(double base_rate, double mrc, double temp)</div><div class="ttdoc">Subtracts respiratory losses from a carbon production rate.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01425">AuxBioCro.cpp:1425</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ac923d835bbf1f5120b1cafcbf3da046d"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ac923d835bbf1f5120b1cafcbf3da046d">absorbed_shortwave_from_incident_ppfd</a></div><div class="ttdeci">double absorbed_shortwave_from_incident_ppfd(double incident_ppfd, double par_energy_content, double par_energy_fraction, double leaf_reflectance, double leaf_transmittance)</div><div class="ttdoc">Computes total absorbed shortwave radiation from the photosynthetically active photon flux density (P...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00120">AuxBioCro.cpp:120</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ad5f0fc680176f312e47c32701ce779f7"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ad5f0fc680176f312e47c32701ce779f7">WINDprof</a></div><div class="ttdeci">void WINDprof(double WindSpeed, double LAI, int nlayers, double *wind_speed_profile)</div><div class="ttdoc">Wind profile function.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00337">AuxBioCro.cpp:337</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ad89278eed741e51c6e3b8e5c0d97318c"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c">get_soil_properties</a></div><div class="ttdeci">soilText_str get_soil_properties(int soiltype)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01493">AuxBioCro.cpp:1493</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ad915026e49b0df9535ad8a75616ae267"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ad915026e49b0df9535ad8a75616ae267">EvapoTrans2</a></div><div class="ttdeci">struct ET_Str EvapoTrans2(double absorbed_shortwave_radiation_et, double absorbed_shortwave_radiation_lt, double airTemp, double RH, double WindSpeed, double stomatal_conductance, double leaf_width, double specific_heat_of_air, double minimum_gbw, int eteq)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00631">AuxBioCro.cpp:640</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ada4de667caf80cb05fccaff44cccb9b1"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a></div><div class="ttdeci">struct rd_str rootDist(int n_layers, double rootDepth, double *depths, double rfl)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01425">AuxBioCro.cpp:1444</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_add002b19ebc8390b467dd10c31bb2cb5"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a></div><div class="ttdeci">double poisson_density(int x, double lambda)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00025">AuxBioCro.cpp:25</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ae316a7cc0aa11d92732e36c4665361ce"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ae316a7cc0aa11d92732e36c4665361ce">water_latent_heat_of_vaporization_henderson</a></div><div class="ttdeci">double water_latent_heat_of_vaporization_henderson(double temperature)</div><div class="ttdoc">Determine the latent heat of vaporization of water from its temperature.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00568">AuxBioCro.cpp:568</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_aeb1ea5a7e843d3a15a3aaeb66f38f9cd"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#aeb1ea5a7e843d3a15a3aaeb66f38f9cd">lightME</a></div><div class="ttdeci">Light_model lightME(double cosine_zenith_angle, double atmospheric_pressure)</div><div class="ttdoc">Calculates some properties of the &quot;light macro environment,&quot; i.e., the light just above the top of th...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00062">AuxBioCro.cpp:62</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a132d736e080fb28f7c4fde8561b02934"><div class="ttname"><a href="_aux_bio_cro_8h.html#a132d736e080fb28f7c4fde8561b02934">soil_parameters</a></div><div class="ttdeci">const std::map&lt; SoilType, soilText_str &gt; soil_parameters</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00109">AuxBioCro.h:109</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a32f5636a03443547a8c316772610c4c1"><div class="ttname"><a href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1">SoilType</a></div><div class="ttdeci">SoilType</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00091">AuxBioCro.h:91</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a32f5636a03443547a8c316772610c4c1a88336b5bb2a1cc21bac7cf33fd451270"><div class="ttname"><a href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1a88336b5bb2a1cc21bac7cf33fd451270">SoilType::sand</a></div><div class="ttdeci">@ sand</div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a57179778cb6aed95fb9f484b55873d6f"><div class="ttname"><a href="_aux_bio_cro_8h.html#a57179778cb6aed95fb9f484b55873d6f">MAXLAY</a></div><div class="ttdeci">#define MAXLAY</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00018">AuxBioCro.h:18</a></div></div>
<div class="ttc" id="a_bio_cro_8h_html"><div class="ttname"><a href="_bio_cro_8h.html">BioCro.h</a></div></div>
<div class="ttc" id="ac4photo_8h_html"><div class="ttname"><a href="c4photo_8h.html">c4photo.h</a></div></div>
<div class="ttc" id="astruct_e_t___str_html"><div class="ttname"><a href="struct_e_t___str.html">ET_Str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00033">AuxBioCro.h:33</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_a53d1afc42e3609e6eb8145169c7b5aaf"><div class="ttname"><a href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">ET_Str::TransR</a></div><div class="ttdeci">double TransR</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00034">AuxBioCro.h:34</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_ac321dc561843cb5d3f74604036a3a8da"><div class="ttname"><a href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">ET_Str::Deltat</a></div><div class="ttdeci">double Deltat</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00037">AuxBioCro.h:37</a></div></div>
<div class="ttc" id="astruct_light__model_html"><div class="ttname"><a href="struct_light__model.html">Light_model</a></div><div class="ttdef"><b>Definition:</b> <a href="_bio_cro_8h_source.html#l00006">BioCro.h:6</a></div></div>
<div class="ttc" id="astruct_light__model_html_a5a75f578f4b205eab5fdd6d95ac2961e"><div class="ttname"><a href="struct_light__model.html#a5a75f578f4b205eab5fdd6d95ac2961e">Light_model::diffuse_irradiance_fraction</a></div><div class="ttdeci">double diffuse_irradiance_fraction</div><div class="ttdef"><b>Definition:</b> <a href="_bio_cro_8h_source.html#l00008">BioCro.h:8</a></div></div>
<div class="ttc" id="astruct_light__model_html_adbd9b09d7568e85d0f64380f3dcdcb47"><div class="ttname"><a href="struct_light__model.html#adbd9b09d7568e85d0f64380f3dcdcb47">Light_model::direct_irradiance_fraction</a></div><div class="ttdeci">double direct_irradiance_fraction</div><div class="ttdef"><b>Definition:</b> <a href="_bio_cro_8h_source.html#l00007">BioCro.h:7</a></div></div>
<div class="ttc" id="astruct_light__profile_html"><div class="ttname"><a href="struct_light__profile.html">Light_profile</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00020">AuxBioCro.h:20</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a0e8db02a88bb67528a3719bccff28ab3"><div class="ttname"><a href="struct_light__profile.html#a0e8db02a88bb67528a3719bccff28ab3">Light_profile::shaded_fraction</a></div><div class="ttdeci">double shaded_fraction[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00029">AuxBioCro.h:29</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a5f4b00c823c545e40c91a4b2ebc5a619"><div class="ttname"><a href="struct_light__profile.html#a5f4b00c823c545e40c91a4b2ebc5a619">Light_profile::average_absorbed_shortwave</a></div><div class="ttdeci">double average_absorbed_shortwave[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00027">AuxBioCro.h:27</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a61f0087975de6eb7f7434b4cfc0e51ae"><div class="ttname"><a href="struct_light__profile.html#a61f0087975de6eb7f7434b4cfc0e51ae">Light_profile::sunlit_fraction</a></div><div class="ttdeci">double sunlit_fraction[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00028">AuxBioCro.h:28</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a73dba19296f83ec076a71483ae244d51"><div class="ttname"><a href="struct_light__profile.html#a73dba19296f83ec076a71483ae244d51">Light_profile::shaded_incident_ppfd</a></div><div class="ttdeci">double shaded_incident_ppfd[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00023">AuxBioCro.h:23</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a9271d425f0a7fe98406dc25f2e148bb4"><div class="ttname"><a href="struct_light__profile.html#a9271d425f0a7fe98406dc25f2e148bb4">Light_profile::height</a></div><div class="ttdeci">double height[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00030">AuxBioCro.h:30</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a9bb181e980d9d35d2856a8710f793539"><div class="ttname"><a href="struct_light__profile.html#a9bb181e980d9d35d2856a8710f793539">Light_profile::incident_ppfd_scattered</a></div><div class="ttdeci">double incident_ppfd_scattered[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00022">AuxBioCro.h:22</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a9be4ce772b6a8d75462522bab9c0512a"><div class="ttname"><a href="struct_light__profile.html#a9be4ce772b6a8d75462522bab9c0512a">Light_profile::sunlit_incident_ppfd</a></div><div class="ttdeci">double sunlit_incident_ppfd[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00021">AuxBioCro.h:21</a></div></div>
<div class="ttc" id="astruct_light__profile_html_aba2bdb68bcb2ed561da09a980ff0373b"><div class="ttname"><a href="struct_light__profile.html#aba2bdb68bcb2ed561da09a980ff0373b">Light_profile::shaded_absorbed_shortwave</a></div><div class="ttdeci">double shaded_absorbed_shortwave[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00026">AuxBioCro.h:26</a></div></div>
<div class="ttc" id="astruct_light__profile_html_ac3f290bdde8c99228d5842027c2fb1fe"><div class="ttname"><a href="struct_light__profile.html#ac3f290bdde8c99228d5842027c2fb1fe">Light_profile::average_incident_ppfd</a></div><div class="ttdeci">double average_incident_ppfd[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00024">AuxBioCro.h:24</a></div></div>
<div class="ttc" id="astruct_light__profile_html_acf30e3338a8853fb5496c2c232459e8b"><div class="ttname"><a href="struct_light__profile.html#acf30e3338a8853fb5496c2c232459e8b">Light_profile::sunlit_absorbed_shortwave</a></div><div class="ttdeci">double sunlit_absorbed_shortwave[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00025">AuxBioCro.h:25</a></div></div>
<div class="ttc" id="astructrd__str_html"><div class="ttname"><a href="structrd__str.html">rd_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00133">AuxBioCro.h:133</a></div></div>
<div class="ttc" id="astructrd__str_html_ab5c89562271d3c87e310c002806858ae"><div class="ttname"><a href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rd_str::rootDist</a></div><div class="ttdeci">double rootDist[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00134">AuxBioCro.h:134</a></div></div>
<div class="ttc" id="astructseq_r_d__str_html"><div class="ttname"><a href="structseq_r_d__str.html">seqRD_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00127">AuxBioCro.h:127</a></div></div>
<div class="ttc" id="astructseq_r_d__str_html_a510f69db6ac897b84a1d62973c365234"><div class="ttname"><a href="structseq_r_d__str.html#a510f69db6ac897b84a1d62973c365234">seqRD_str::rootDepths</a></div><div class="ttdeci">double rootDepths[MAXLAY+1]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00128">AuxBioCro.h:128</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html"><div class="ttname"><a href="structsoil_m_l__str.html">soilML_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00058">AuxBioCro.h:58</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a1181d419ee6ec88951ccc5d991626005"><div class="ttname"><a href="structsoil_m_l__str.html#a1181d419ee6ec88951ccc5d991626005">soilML_str::SoilEvapo</a></div><div class="ttdeci">double SoilEvapo</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00064">AuxBioCro.h:64</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a26953bee326ec08f079e24838fc8feb6"><div class="ttname"><a href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">soilML_str::Nleach</a></div><div class="ttdeci">double Nleach</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00063">AuxBioCro.h:63</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a50be45bf1a7676b85f348d2a38d900b7"><div class="ttname"><a href="structsoil_m_l__str.html#a50be45bf1a7676b85f348d2a38d900b7">soilML_str::rcoefPhoto</a></div><div class="ttdeci">double rcoefPhoto</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00059">AuxBioCro.h:59</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a6b156f63a9c5f2185dcb004e85518998"><div class="ttname"><a href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">soilML_str::drainage</a></div><div class="ttdeci">double drainage</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00062">AuxBioCro.h:62</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a9da7a4e25e646b0be31ac3bbec73f60d"><div class="ttname"><a href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">soilML_str::cws</a></div><div class="ttdeci">double cws[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00061">AuxBioCro.h:61</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_ab5c89562271d3c87e310c002806858ae"><div class="ttname"><a href="structsoil_m_l__str.html#ab5c89562271d3c87e310c002806858ae">soilML_str::rootDist</a></div><div class="ttdeci">double rootDist[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00065">AuxBioCro.h:65</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_aff37ff3493aa80130290d80445e09c03"><div class="ttname"><a href="structsoil_m_l__str.html#aff37ff3493aa80130290d80445e09c03">soilML_str::rcoefSpleaf</a></div><div class="ttdeci">double rcoefSpleaf</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00060">AuxBioCro.h:60</a></div></div>
<div class="ttc" id="astructsoil_text__str_html"><div class="ttname"><a href="structsoil_text__str.html">soilText_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00078">AuxBioCro.h:78</a></div></div>
<div class="ttc" id="astructws__str_html"><div class="ttname"><a href="structws__str.html">ws_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00051">AuxBioCro.h:51</a></div></div>
<div class="ttc" id="astructws__str_html_a26953bee326ec08f079e24838fc8feb6"><div class="ttname"><a href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">ws_str::Nleach</a></div><div class="ttdeci">double Nleach</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00055">AuxBioCro.h:55</a></div></div>
<div class="ttc" id="astructws__str_html_a365dc60f2331a4280fc2be55b822191c"><div class="ttname"><a href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">ws_str::runoff</a></div><div class="ttdeci">double runoff</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00054">AuxBioCro.h:54</a></div></div>
<div class="ttc" id="astructws__str_html_aa293628634276d793267cbf2542ce2e2"><div class="ttname"><a href="structws__str.html#aa293628634276d793267cbf2542ce2e2">ws_str::awc</a></div><div class="ttdeci">double awc</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00052">AuxBioCro.h:52</a></div></div>
<div class="ttc" id="astructws__str_html_ac2f458ad74016a5af57f18d9774bb0d9"><div class="ttname"><a href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">ws_str::psim</a></div><div class="ttdeci">double psim</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00053">AuxBioCro.h:53</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_567355a66c5b87dfe03a58cbdce72993.html">module_library</a></li><li class="navelem"><a class="el" href="_aux_bio_cro_8cpp.html">AuxBioCro.cpp</a></li>
    <li class="footer">Generated on Fri Nov 3 2023 01:37:31 for The BioCro C++ Library by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
